<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guida Addestramento Cucciolo Super Felice ü¶¥üêæ‚ù§Ô∏è</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEGUlEQVR4AbWXA5JsWRCFt7Jtl3VXdu3aTnfduu7a7tq1a9uu67qOu3Nn7iTTJZkkQyZzZqIzf7xZ5Hk9TwA+Ev/pT/H8+vVrYQghCEInLz+/9Nlnn10F/xlSSimEEKWUAfLz84tDQ0NvKioqpKenJ3788cedvLz8TfxDkiS5XA6H43A4HI7H43G5XEnyh+fff/99Hhsb+zQzM3M0Nzc3O51Ozc/Pz361Wg0Ae3t7P8PDw78Hg8H3dXd339vb2/tLS0vLhUIhUbFY/DcYDP4dHR39qKOj46GhoSEcDof/hoaG/kM+ISsri6aKCgoGx44dO7Zp06bNmJgYjL1nzhwbNmwYEBwc9J///Of77Nmz7/Dw8D8QCGytra1fKyoqPgEBAZ/AwMAgFAoVCoVCpVKhVCqRSCSKonEcZ7lcGIbhOI4syzLGAIAxBsMwhmEMwxjDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMAzD2Gw29ff3R6PRAJRSCCGEEEIIIYQQQgghhBBCSCHGGFKKSClFKUUIISCkiIiIAAAEBgYCAAAgIyOD4uLikKSJoiiK4ziOoygKANTU1ODo6IjPnz+jt7cXsixjbGxsODg4qKqqihBCSqmqKkIIURRFURRFURTFcZwgCCdPntTW1rYtLy+XhoaG/AYGBv4hH2tra2NjY+MPxGIxFycnJz8iIiL+AgMDf7darb+AfPly5dq1a9fGxsZ29fb2/hoaGvrD4fDvkCRJ/gEBHx+fdxKJxPdAILD3G/j9999bWVkZ2ffGG2+cNHLkSMDfvXt32NraGhQUFMSSXbp06S+++OKLrKys/Ojo6F/g5eXlwWAw+PvFixdv3rx584YNG4YkSdJutzs9PT0KhQIAcHJyMjk5OYFAAIAdO3bIyMhAKpUCAKCnp4ewsBAcDgcAFItFLBYLAFBQUIDs7GwAxGIxWVlZAMhkMkFBQQCAw+EQERGhkJAQpFIpACAYDAYHBzM7O5tCoRAdHQ0AiEQiMjOzAABZWVmFhIQCAKCnp7u0tDQAIBgMPjU1NRYWFsbY29tPmZqa+tPS0vKWlpaWQqEQNBgMAgAoFArX1tZu27ZtGwMDAx+VSqVzBQUFP0lJSf8hHx8f/xkMBr+Bf/nyZUdHR38B/+uvv0qSJEmyWCz+AcTExPwbGhqalZSU/F/5R+0r+w4p7A4Q7AAAAABJRU5ErkJggg==">
    <style>
        :root {
            /* Palette fornita */
            --palette-color1: #4DA8DA; /* Azzurro cielo */
            --palette-color2: #80D8C3; /* Verde acqua/Menta */
            --palette-color3: #FFD66B; /* Giallo sole/Mais */
            --palette-color4: #F5F5F5; /* Grigio chiarissimo/Bianco sporco */
            /* Ho aggiunto un colore scuro per i testi nel tema chiaro, dato che la palette ne era priva */
            --palette-dark-text-contrast: #2c3e50; /* Blu scuro intenso per contrasto */
            --palette-accent-hover-darker: color-mix(in srgb, var(--palette-color3) 80%, black 20%);


            /* Puppy Theme - Light */
            --puppy-bg-light: var(--palette-color4);
            --puppy-block-bg-light: var(--palette-color1);
            --puppy-block-bg-hover-light: color-mix(in srgb, var(--palette-color1) 85%, #fff 15%);
            --puppy-accent-light: var(--palette-color3);
            --puppy-accent-dark-light: var(--palette-accent-hover-darker);
            --puppy-text-primary-light: var(--palette-dark-text-contrast);
            --puppy-text-secondary-light: color-mix(in srgb, var(--palette-dark-text-contrast) 60%, var(--palette-color1) 40%);
            --puppy-card-bg-light: #ffffff;
            --puppy-paw-print-light: var(--palette-color2); /* Verde acqua per le zampe */
            --puppy-button-theme-bg-l: var(--palette-dark-text-contrast);
            --puppy-button-theme-text-l: var(--palette-color4);
            --puppy-pattern-blend-light: overlay;


            /* Puppy Theme - Dark */
            --puppy-bg-dark: #1e2a3a;  /* Un blu notte profondo */
            --puppy-block-bg-dark: var(--palette-color1); /* Azzurro cielo anche per blocchi scuri, per un look fresco */
            --puppy-block-bg-hover-dark: color-mix(in srgb, var(--palette-color1) 85%, var(--palette-color4) 15%);
            --puppy-accent-dark-theme: var(--palette-color3);
            --puppy-accent-dark-dark-theme: var(--palette-accent-hover-darker);
            --puppy-text-primary-dark: var(--palette-color4);
            --puppy-text-secondary-dark: var(--palette-color2); /* Verde acqua per testo secondario */
            --puppy-card-bg-dark: #2a3b4f;
            --puppy-paw-print-dark: var(--palette-color2);
            --puppy-button-theme-bg-d: var(--palette-color4);
            --puppy-button-theme-text-d: var(--palette-dark-text-contrast);
            --puppy-pattern-blend-dark: lighten;


            /* Current Variables */
            --current-body-bg: var(--puppy-bg-dark);
            --current-pattern-blend-mode: var(--puppy-pattern-blend-dark);
            --current-block-bg: var(--puppy-block-bg-dark);
            --current-block-bg-hover: var(--puppy-block-bg-hover-dark);
            --current-card-bg: var(--puppy-card-bg-dark);
            --current-text-primary: var(--puppy-text-primary-dark);
            --current-text-secondary: var(--puppy-text-secondary-dark);
            --current-accent: var(--puppy-accent-dark-theme);
            --current-accent-dark: var(--puppy-accent-dark-dark-theme);
            --current-paw-print-color: var(--puppy-paw-print-dark);
            --current-button-theme-bg: var(--puppy-button-theme-bg-d);
            --current-button-theme-text: var(--puppy-button-theme-text-d);
        }

        body.light-theme {
            --current-body-bg: var(--puppy-bg-light);
            --current-pattern-blend-mode: var(--puppy-pattern-blend-light);
            --current-block-bg: var(--puppy-block-bg-light);
            --current-block-bg-hover: var(--puppy-block-bg-hover-light);
            --current-card-bg: var(--puppy-card-bg-light);
            --current-text-primary: var(--puppy-text-primary-light);
            --current-text-secondary: var(--puppy-text-secondary-light);
            --current-accent: var(--puppy-accent-light);
            --current-accent-dark: var(--puppy-accent-dark-light);
            --current-paw-print-color: var(--puppy-paw-print-light);
            --current-button-theme-bg: var(--puppy-button-theme-bg-l);
            --current-button-theme-text: var(--puppy-button-theme-text-l);
        }

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--current-body-bg);
            color: var(--current-text-primary);
            transition: background-color 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
            
            background-image: url('dog-pat-bk.jpg'); /* Default per tema scuro */
            background-size: 200px 200px;
            background-repeat: repeat;
            background-blend-mode: var(--current-pattern-blend-mode);
        }
        body.light-theme {
            background-image: url('dog-pat.jpg'); /* Specifica per tema chiaro */
        }


        .page-title-container {
            text-align: center;
            margin-bottom: 35px;
            background-color: color-mix(in srgb, var(--current-card-bg) 90%, transparent);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.07);
            border: 1px solid var(--current-block-bg);
        }
        .page-title {
            font-family: 'Russo One', sans-serif;
            font-size: clamp(2.3em, 7vw, 3.5em);
            color: var(--current-accent);
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px color-mix(in srgb, var(--current-text-primary) 20%, transparent);
        }
        .page-subtitle {
            font-size: clamp(1em, 3.5vw, 1.2em);
            color: var(--current-text-secondary);
            font-weight: 600;
        }

        .items-list-container {
            display: flex;
            flex-direction: column;
            gap: 0px;
        }

        .item-block-header {
            background-color: var(--current-block-bg);
            padding: 14px 18px;
            margin-top: 12px;
            border-radius: 10px 10px 0 0;
            font-family: 'Russo One', sans-serif;
            color: var(--current-text-primary);
            border-left: 7px solid var(--current-accent);
            box-shadow: 0 4px 8px rgba(0,0,0,0.12);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease, opacity 0.3s ease;
            position: relative;
        }
        body.light-theme .item-block-header { /* Testo pi√π scuro per header su tema chiaro */
             color: var(--palette-dark-text-contrast);
        }


        .item-block-header:hover {
            background-color: var(--current-block-bg-hover);
        }
        .item-block-header.expanded {
             border-radius: 10px 10px 0 0;
        }
        .item-block-header:not(.expanded) {
             border-radius: 10px;
        }
        .item-block-header.all-completed {
            opacity: 0.75;
            background-color: color-mix(in srgb, var(--current-block-bg) 60%, var(--current-body-bg) 40%);
        }
         .item-block-header.all-completed .header-info .phase-title {
            text-decoration: line-through wavy var(--current-accent) 2px;
            color: var(--current-text-secondary);
         }

        .toggle-icon, .completed-block-icon {
            margin-right: 14px;
            font-size: 1.4em;
            color: var(--current-accent);
            transition: transform 0.2s ease-in-out;
            width: 24px;
            display: inline-block;
            text-align: center;
            line-height: 1;
            flex-shrink: 0;
        }
         .completed-block-icon {
            font-weight: bold;
            color: var(--current-paw-print-color);
         }
        .item-block-header.expanded .toggle-icon {
            transform: rotate(90deg);
        }

        .header-info {
            flex-grow: 1;
            min-width: 0;
        }
        .header-info .phase-title {
            font-size: 1.2em;
            font-weight: 700;
            font-family: 'Open Sans', sans-serif;
            /* Il colore √® gestito dalla specificit√† di .item-block-header e body.light-theme .item-block-header */
        }
              
        .card-group-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(310px, 1fr));
            gap: 18px;
            padding: 18px;
            background-color: color-mix(in srgb, var(--current-block-bg) 80%, var(--current-body-bg) 20%);
            border-radius: 0 0 10px 10px;
            border-left: 7px solid var(--current-accent);
            border-right: 1px solid var(--current-block-bg);
            border-bottom: 1px solid var(--current-block-bg);
            margin-bottom:12px;
            transition: background-color 0.3s;
        }
        .card-group-container.collapsed {
            display: none;
            padding: 0;
            margin-bottom:0;
        }

        .card {
            background-color: var(--current-card-bg);
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.09);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-top: 5px solid var(--current-accent);
            transition: opacity 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s;
            color: var(--current-text-primary);
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 7px 15px rgba(0,0,0,0.13), 0 0 12px color-mix(in srgb, var(--current-accent) 60%, transparent);
        }

        .card-video-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }
        .card-thumbnail-container {
            margin-bottom: 14px;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--current-block-bg);
        }
        .card-thumbnail {
            width: 100%;
            height: auto;
            display: block;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .card-video-link:hover .card-thumbnail {
            transform: scale(1.07);
        }
        .card-thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .card-video-link:hover .card-thumbnail-overlay {
            opacity: 1;
        }
        .play-icon {
            font-size: 3.5em;
            color: white;
            text-shadow: 0 0 12px rgba(0,0,0,0.7);
        }

        .card-title {
            font-weight: 700;
            font-size: 1.15em;
            margin-bottom: 6px;
            color: var(--current-text-primary);
            word-break: break-word;
        }
        .card-reason {
            font-size: 0.95em;
            color: var(--current-text-secondary);
            margin-bottom: 14px;
            font-style: italic;
            line-height: 1.5;
        }
      
        .card-footer {
            margin-top: auto;
            padding-top: 14px;
            border-top: 1px solid var(--current-block-bg-hover);
            display: flex;
            align-items: center;
        }
        .completed-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2.5px solid var(--current-accent);
            border-radius: 5px;
            margin-right: 10px;
            cursor: pointer;
            position: relative;
            outline: none;
            flex-shrink: 0;
            transition: background-color 0.2s, transform 0.1s;
        }
        .completed-checkbox:hover {
            transform: scale(1.1);
        }
        .completed-checkbox:checked {
            background-color: var(--current-accent);
        }
        .completed-checkbox:checked::before {
            content: '‚úî';
            font-size: 16px;
            color: var(--palette-dark-text-contrast); /* Colore scuro per contrasto con accento giallo/arancio */
            position: absolute;
            top: -1px;
            left: 2px;
            font-weight: bold;
        }

        .completed-label {
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: var(--current-text-secondary);
        }
        .card.completed {
            opacity: 0.65;
            border-top-color: var(--current-text-secondary);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1), 0 2px 5px rgba(0,0,0,0.05);
        }
        .card.completed::after {
            content: "üêæ";
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 2.2em;
            color: var(--current-paw-print-color);
            opacity: 1;
            pointer-events: none;
            transform: rotate(15deg);
        }
        .card.completed .card-title {
            text-decoration: line-through wavy var(--current-accent) 1.5px;
        }
        .card.completed:hover {
             box-shadow: inset 0 0 10px rgba(0,0,0,0.15), 0 5px 10px rgba(0,0,0,0.12), 0 0 10px color-mix(in srgb, var(--current-accent-dark) 50%, transparent);
        }

        .filters {
            background-color: var(--current-block-bg);
            padding: 18px;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px 15px;
            transition: background-color 0.3s;
        }
        .filters label {
            margin-right: 6px;
            font-size: 0.95em;
            font-weight: 600;
            color: var(--current-text-primary);
        }
         body.light-theme .filters label {
            color: var(--palette-dark-text-contrast);
        }

        .filters input[type="checkbox"] {
            margin-right: 5px;
            transform: scale(1.15);
            accent-color: var(--current-accent);
        }
      
        .filters button {
            padding: 10px 16px;
            background-color: var(--current-accent);
            color: var(--palette-dark-text-contrast);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-family: 'Russo One', sans-serif;
            letter-spacing: 0.7px;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .filters button:hover {
            background-color: var(--current-accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .filters button:active {
            transform: translateY(0px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .filters button#theme-toggle {
            background-color: var(--current-button-theme-bg);
            color: var(--current-button-theme-text);
            font-size: 1.3em;
            padding: 8px 12px;
            min-width: 45px;
        }
         .filters button#theme-toggle:hover {
            background-color: color-mix(in srgb, var(--current-button-theme-bg) 80%, black 20%);
        }

        .notes-container {
            background-color: var(--current-card-bg);
            padding: 25px 30px;
            margin-top: 35px;
            border-radius: 12px;
            box-shadow: 0 4px 9px rgba(0,0,0,0.09);
        }
        .notes-container h3 {
            font-family: 'Russo One', sans-serif;
            color: var(--current-accent);
            margin-top: 0;
            border-bottom: 2.5px solid var(--current-accent-dark);
            padding-bottom: 10px;
            font-size: 1.4em;
        }
        .notes-container ul {
            list-style-type: 'ü¶¥ ';
            padding-left: 30px;
            color: var(--current-text-secondary);
            font-size: 1em;
            line-height: 1.8;
            font-weight: 500;
        }
        .notes-container li {
            margin-bottom: 10px;
        }

        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: var(--current-block-bg-hover);
            border-radius: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--current-accent);
            border-radius: 6px;
            border: 2px solid var(--current-block-bg-hover);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--current-accent-dark);
        }

        @media (hover: none) and (pointer: coarse) {
            .completed-checkbox {
                transform: scale(1.3);
                margin-right: 12px;
            }
            .filters input[type="checkbox"] {
                transform: scale(1.3);
            }
        }

    </style>
</head>
<body>
    <div class="page-title-container">
        <h1 class="page-title">Guida Addestramento Cucciolo ü¶¥üêæ‚ù§Ô∏è</h1>
        <p class="page-subtitle" id="page-description-area">Esercizi e consigli per crescere un compagno felice ed educato!</p>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label><input type="checkbox" id="filter-hide-completed"> Nascondi Fatti</label>
        </div>
        <div class="action-buttons">
            <button id="theme-toggle">‚òÄÔ∏è</button>
            <button id="uncheck-all-visible">Deseleziona Visibili</button>
            <button id="check-all-visible">Seleziona Visibili</button>
        </div>
    </div>

    <div id="app-container">
        <!-- Le fasi di addestramento verranno caricate qui -->
    </div>
    
    <div id="notes-section-container">
        <!-- Le note importanti verranno caricate qui -->
    </div>


    <script>
        const puppyTrainingData = {
          "sequenza_addestramento_cuccioli": {
            "descrizione": "Esercizi ordinati dalla base fondamentale ai pi√π complessi, rispettando le dipendenze pedagogiche",
            "fasi": [
              {
                "fase_id": "1_fondamentali_base",
                "descrizione": "Comandi di base essenziali - prerequisiti per tutto il resto",
                "esercizi": [
                  { "ordine": 1, "titolo": "GUARDAMI", "link": "https://www.youtube.com/watch?v=moJn1-jpQgU", "motivo": "Fondamentale per ottenere attenzione - prerequisito per tutti gli altri comandi" },
                  { "ordine": 2, "titolo": "SEDUTO", "link": "https://www.youtube.com/watch?v=_4FxsvIihag", "motivo": "Comando base essenziale - prerequisito per zampa, resta, e molti altri" },
                  { "ordine": 3, "titolo": "RESTA", "link": "https://www.youtube.com/watch?v=Nm8lYSEkZmA", "motivo": "Controllo e pazienza - si basa sul seduto e migliora l'autocontrollo" }
                ]
              },
              {
                "fase_id": "2_comandi_posizione",
                "descrizione": "Altri comandi di posizione che si basano sui fondamentali",
                "esercizi": [
                  { "ordine": 4, "titolo": "TERRA", "link": "https://www.youtube.com/watch?v=wKbMvibtAWE", "motivo": "Posizione base importante - spesso pi√π facile dal seduto" },
                  { "ordine": 5, "titolo": "TERRA (metodo alternativo)", "link": "https://www.youtube.com/watch?v=Ftxjekbximg", "motivo": "Rinforzo del comando terra con approccio diverso" },
                  { "ordine": 6, "titolo": "STAND", "link": "https://www.youtube.com/watch?v=6gub6FiBbvc", "motivo": "Posizione in piedi - utile per completare le posizioni base" }
                ]
              },
              {
                "fase_id": "3_controllo_comportamento",
                "descrizione": "Comandi per controllo e comportamento educato",
                "esercizi": [
                  { "ordine": 7, "titolo": "LASCIA", "link": "https://www.youtube.com/watch?v=tOaXtc2a184", "motivo": "Autocontrollo importante per sicurezza - si basa sui comandi base" },
                  { "ordine": 8, "titolo": "AL POSTO e PIEDE", "link": "https://www.youtube.com/watch?v=zacUwZy9PxQ", "motivo": "Posizionamento e controllo durante la camminata" },
                  { "ordine": 9, "titolo": "CAMMINATA AL GUINZAGLIO (Walk Near)", "link": "https://www.youtube.com/watch?v=SooVv_S1_Y0", "motivo": "Comportamento al guinzaglio - si basa su piede e controllo generale" }
                ]
              },
              {
                "fase_id": "4_richiamo_riporto",
                "descrizione": "Comandi di interazione e richiamo",
                "esercizi": [
                  { "ordine": 10, "titolo": "RICHIAMO", "link": "https://www.youtube.com/watch?v=XKyHysOPEXU", "motivo": "Comando di sicurezza fondamentale - richiede buona base educativa" },
                  { "ordine": 11, "titolo": "RIPORTO", "link": "https://www.youtube.com/watch?v=1vempIyKvvg", "motivo": "Interazione complessa che richiede controllo e richiamo" },
                  { "ordine": 12, "titolo": "TOUCH", "link": "https://www.youtube.com/watch?v=Hm4J_bmwUGQ", "motivo": "Comando di contatto e attenzione - rinforza il legame" }
                ]
              },
              {
                "fase_id": "5_tricks_semplici",
                "descrizione": "Primi trick che si basano sui comandi fondamentali",
                "esercizi": [
                  { "ordine": 13, "titolo": "DARE LA ZAMPA", "link": "https://www.youtube.com/watch?v=SVsbSj4cro0", "motivo": "Richiede il seduto come prerequisito - primo trick semplice" },
                  { "ordine": 14, "titolo": "BATTI 5", "link": "https://www.youtube.com/watch?v=h0RKRznlBmw", "motivo": "Evoluzione di 'dare la zampa' - pi√π dinamico" },
                  { "ordine": 15, "titolo": "FAI CIAO", "link": "https://www.youtube.com/watch?v=RcjLnMykKm4", "motivo": "Variazione della zampa - movimento della zampa pi√π elaborato" }
                ]
              },
              {
                "fase_id": "6_tricks_intermedi",
                "descrizione": "Trick che richiedono maggiore coordinazione",
                "esercizi": [
                  { "ordine": 16, "titolo": "INCHINO", "link": "https://www.youtube.com/watch?v=4Dd5_3yW4kQ", "motivo": "Trick elegante che richiede controllo del corpo" },
                  { "ordine": 17, "titolo": "TWIST", "link": "https://www.youtube.com/watch?v=BZRX_tfgshE", "motivo": "Movimento rotatorio semplice - introduce la rotazione" },
                  { "ordine": 18, "titolo": "OTTO", "link": "https://www.youtube.com/watch?v=HBOqb5jJWBM", "motivo": "Movimento complesso che richiede coordinazione e controllo" },
                  { "ordine": 19, "titolo": "PASSARE SOTTO LE GAMBE", "link": "https://www.youtube.com/watch?v=o4jicbWoZSE", "motivo": "Trick di movimento che richiede fiducia e controllo spaziale" }
                ]
              },
              {
                "fase_id": "7_tricks_complessi",
                "descrizione": "Trick avanzati che richiedono buona base educativa",
                "esercizi": [
                  { "ordine": 20, "titolo": "ROTOLA", "link": "https://www.youtube.com/watch?v=OBRirKuCmEo", "motivo": "Richiede il terra come prerequisito - movimento complesso" },
                  { "ordine": 21, "titolo": "BANG", "link": "https://www.youtube.com/watch?v=QzANhdZFpvk", "motivo": "Trick teatrale che combina posizione e 'morte' drammatica" },
                  { "ordine": 22, "titolo": "VERGOGNA", "link": "https://www.youtube.com/watch?v=7FoCZ_TOzjM", "motivo": "Trick espressivo che richiede controllo fine delle zampe" },
                  { "ordine": 23, "titolo": "ORSETTO", "link": "https://www.youtube.com/watch?v=ZFry0VaJBiw", "motivo": "Posizione eretta che richiede equilibrio e forza" }
                ]
              },
              {
                "fase_id": "8_interazione_avanzata",
                "descrizione": "Comandi di interazione pi√π sofisticati",
                "esercizi": [
                  { "ordine": 24, "titolo": "BACK", "link": "https://www.youtube.com/watch?v=2dFauxFYsvs", "motivo": "Movimento all'indietro - richiede buon controllo spaziale" },
                  { "ordine": 25, "titolo": "BACIO", "link": "https://www.youtube.com/watch?v=ldATecGsTZg", "motivo": "Interazione affettuosa che richiede controllo e delicatezza" },
                  { "ordine": 26, "titolo": "MUSO", "link": "https://www.youtube.com/watch?v=dGUySvQspWI", "motivo": "Comando di contatto pi√π specifico e controllato" }
                ]
              },
              {
                "fase_id": "9_attivita_mentale",
                "descrizione": "Attivit√† per stimolazione mentale e problem solving",
                "esercizi": [
                  { "ordine": 27, "titolo": "CERCA", "link": "https://www.youtube.com/watch?v=59Jq8kW42z8", "motivo": "Stimolazione mentale attraverso ricerca - richiede controllo base" },
                  { "ordine": 28, "titolo": "RICERCA PREMI NASCOSTI", "link": "https://www.youtube.com/watch?v=KPeXPuaGGtA", "motivo": "Gioco educativo per stimolazione mentale in casa" },
                  { "ordine": 29, "titolo": "TAPPETINO OLFATTIVO", "link": "https://www.youtube.com/watch?v=ic9Yw5fJDw4", "motivo": "Strumento per stimolazione olfattiva e rilassamento" },
                  { "ordine": 30, "titolo": "RICERCA OLFATTIVA VERTICALE", "link": "https://www.youtube.com/watch?v=AexANWRo8ZQ", "motivo": "Ricerca pi√π avanzata che sviluppa capacit√† olfattive" }
                ]
              },
              {
                "fase_id": "10_problem_solving",
                "descrizione": "Esercizi di problem solving per sviluppo cognitivo",
                "esercizi": [
                  { "ordine": 31, "titolo": "PROBLEM SOLVING - ASCIUGAMANO", "link": "https://www.youtube.com/watch?v=rkGMJ6Koo4I", "motivo": "Primo esercizio di problem solving - relativamente semplice" },
                  { "ordine": 32, "titolo": "PROBLEM SOLVING - ROTOLO", "link": "https://www.youtube.com/watch?v=5ozG8gWqLek", "motivo": "Secondo livello di difficolt√† nel problem solving" },
                  { "ordine": 33, "titolo": "PROBLEM SOLVING - BICCHIERI", "link": "https://www.youtube.com/watch?v=NODeoDg8vK0", "motivo": "Problema pi√π complesso che richiede maggiore ragionamento" },
                  { "ordine": 34, "titolo": "PROBLEM SOLVING - LIVELLI", "link": "https://www.youtube.com/watch?v=-iUN82IpOV8", "motivo": "Esercizio tridimensionale pi√π avanzato" },
                  { "ordine": 35, "titolo": "PROBLEM SOLVING - TUBO CHE GIRA", "link": "https://www.youtube.com/watch?v=ewVMqFuwI_U", "motivo": "Problema meccanico complesso" },
                  { "ordine": 36, "titolo": "PROBLEM SOLVING - CESTO", "link": "https://www.youtube.com/watch?v=OL0fIkq9Dfs", "motivo": "Ultimo livello di problem solving - pi√π difficile" }
                ]
              },
              {
                "fase_id": "11_mobility_avanzata",
                "descrizione": "Esercizi di mobility e coordinazione avanzata",
                "esercizi": [
                  { "ordine": 37, "titolo": "MOBILITY - PODIO", "link": "https://www.youtube.com/watch?v=5QCER8sdn_k", "motivo": "Esercizio di equilibrio e fiducia su superfici elevate" }
                ]
              },
              {
                "fase_id": "12_attivita_speciali",
                "descrizione": "Attivit√† specializzate e giochi avanzati",
                "esercizi": [
                  { "ordine": 38, "titolo": "PREYDUMMY", "link": "https://www.youtube.com/watch?v=YNefholHKfM", "motivo": "Gioco di caccia simulata per cani con istinto predatorio" },
                  { "ordine": 39, "titolo": "COME FARE TRECCIA PER MORSO", "link": "https://www.youtube.com/watch?v=YmTvP4GuIwM", "motivo": "Costruzione di strumenti per addestramento" }
                ]
              },
              {
                "fase_id": "13_comportamenti_vita_quotidiana",
                "descrizione": "Addestramento per situazioni di vita quotidiana",
                "esercizi": [
                  { "ordine": 40, "titolo": "STARE A CASA DA SOLO", "link": "https://www.youtube.com/watch?v=LRR2DvZ06T4", "motivo": "Comportamento essenziale per la vita domestica - richiede maturit√†" }
                ]
              },
              {
                "fase_id": "14_mantenimento",
                "descrizione": "Principi di mantenimento e continuit√† dell'addestramento",
                "esercizi": [
                  { "ordine": 41, "titolo": "ESERCIZIO NON VA MAI IN VACANZA", "link": "https://www.youtube.com/watch?v=ZLTgfWBHUrQ", "motivo": "Principi di continuit√† nell'addestramento" },
                  { "ordine": 42, "titolo": "GIOCHI ED ESERCIZI GENERALI", "link": "https://www.youtube.com/watch?v=RKLeTlPXxBo", "motivo": "Panoramica generale su giochi e esercizi vari" }
                ]
              }
            ],
            "note_importanti": [
              "Iniziare sempre con i comandi fondamentali prima di passare ai trick.",
              "Il 'SEDUTO' √® prerequisito essenziale per 'ZAMPA', 'RESTA', e molti altri comandi.",
              "Il 'TERRA' √® necessario prima di insegnare 'ROTOLA'.",
              "Consolidare ogni comando prima di passare al successivo.",
              "Gli esercizi di problem solving richiedono una buona base educativa.",
              "Adattare i tempi alle capacit√† individuali del cucciolo.",
              "Mantenere sessioni brevi e positive, specialmente per i cuccioli."
            ]
          }
        };

        const COMPLETED_STORAGE_KEY = 'puppyTrainingTrackerCompleted_v6'; // increment version
        const EXPANDED_BLOCKS_KEY = 'puppyTrainingExpandedBlocks_v6';
        const THEME_KEY = 'puppyTrainingTrackerTheme_v6';
        const FILTERS_STATE_KEY = 'puppyTrainingFiltersState_v6';

        let completedItems = {};
        let expandedBlocks = {};
        
        const appContainer = document.getElementById('app-container');
        const notesSectionContainer = document.getElementById('notes-section-container');
        const pageDescriptionArea = document.getElementById('page-description-area');

        const filterHideCompletedEl = document.getElementById('filter-hide-completed');
        const uncheckAllVisibleButton = document.getElementById('uncheck-all-visible');
        const checkAllVisibleButton = document.getElementById('check-all-visible');
        const themeToggleButton = document.getElementById('theme-toggle');

        function getYoutubeVideoId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function getYoutubeThumbnailUrl(videoId, quality = 'mqdefault') {
            if (!videoId) return 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
            return `https://img.youtube.com/vi/${videoId}/${quality}.jpg`;
        }
        
        function applyCurrentTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            const body = document.body;
            if (savedTheme === 'light') {
                body.classList.add('light-theme');
                themeToggleButton.textContent = 'üåô';
            } else {
                body.classList.remove('light-theme');
                themeToggleButton.textContent = '‚òÄÔ∏è';
            }
            // L'immagine di sfondo √® gi√† gestita dal CSS specifico per tema
        }

        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            if (document.body.classList.contains('light-theme')) {
                localStorage.setItem(THEME_KEY, 'light');
                themeToggleButton.textContent = 'üåô';
            } else {
                localStorage.setItem(THEME_KEY, 'dark');
                themeToggleButton.textContent = '‚òÄÔ∏è';
            }
            // L'immagine di sfondo √® gi√† gestita dal CSS specifico per tema
        }


        function saveFiltersState() {
            const filtersState = {
                hideCompleted: filterHideCompletedEl.checked
            };
            localStorage.setItem(FILTERS_STATE_KEY, JSON.stringify(filtersState));
        }

        function loadState() {
            const storedCompleted = localStorage.getItem(COMPLETED_STORAGE_KEY);
            if (storedCompleted) completedItems = JSON.parse(storedCompleted);
            else completedItems = {};

            const storedExpanded = localStorage.getItem(EXPANDED_BLOCKS_KEY);
            if (storedExpanded) expandedBlocks = JSON.parse(storedExpanded);
            else expandedBlocks = {};

            const storedFilters = localStorage.getItem(FILTERS_STATE_KEY);
            if (storedFilters) {
                const filtersState = JSON.parse(storedFilters);
                filterHideCompletedEl.checked = filtersState.hideCompleted;
            } else {
                filterHideCompletedEl.checked = false;
            }
        }

        function saveCompletedStatus() {
            localStorage.setItem(COMPLETED_STORAGE_KEY, JSON.stringify(completedItems));
        }

        function saveExpandedState() {
            localStorage.setItem(EXPANDED_BLOCKS_KEY, JSON.stringify(expandedBlocks));
        }

        function generateItemId(faseId, esercizioOrdine) {
            return `fase_${faseId}_ex${esercizioOrdine}`;
        }

        function generateBlockId(faseId) {
            return `block_fase_${faseId}`;
        }
        
        function checkAllItemsInBlockCompleted(blockId, fase) {
            if (!fase || !fase.esercizi || fase.esercizi.length === 0) return false;
            return fase.esercizi.every(ex => {
                const cardId = generateItemId(fase.fase_id, ex.ordine);
                return !!completedItems[cardId];
            });
        }

        function updateBlockHeaderStatus(headerEl, blockId, fase) {
            if (!headerEl || !fase) return;

            const allCompleted = checkAllItemsInBlockCompleted(blockId, fase);
            const iconEl = headerEl.querySelector('span:first-child');

            headerEl.classList.toggle('all-completed', allCompleted);

            if (iconEl) {
                if (allCompleted) {
                    iconEl.classList.remove('toggle-icon');
                    iconEl.classList.add('completed-block-icon');
                    iconEl.innerHTML = 'üêæ';
                } else {
                    iconEl.classList.remove('completed-block-icon');
                    iconEl.classList.add('toggle-icon');
                    iconEl.innerHTML = headerEl.classList.contains('expanded') ? '‚ñº' : '‚ñ∫';
                }
            }
        }

        function applyFilters() {
            const hideCompleted = filterHideCompletedEl.checked;

            document.querySelectorAll('.item-block-header').forEach(headerEl => {
                const blockId = headerEl.dataset.blockId;
                const faseId = blockId.replace('block_fase_', '');
                const fase = puppyTrainingData.sequenza_addestramento_cuccioli.fasi.find(f => f.fase_id === faseId);

                if (!fase) return;

                const isBlockAllCompleted = checkAllItemsInBlockCompleted(blockId, fase);
                
                if (hideCompleted && isBlockAllCompleted) {
                    headerEl.style.display = 'none';
                    const cardGroupContainer = document.querySelector(`.card-group-container[data-content-for="${blockId}"]`);
                    if (cardGroupContainer) cardGroupContainer.style.display = 'none';
                    return;
                }
                
                headerEl.style.display = 'flex';
                
                const cardGroupContainer = document.querySelector(`.card-group-container[data-content-for="${blockId}"]`);
                if (cardGroupContainer) {
                    if (headerEl.classList.contains('expanded')) {
                        cardGroupContainer.style.display = 'grid';
                        let hasVisibleCards = false;
                        cardGroupContainer.querySelectorAll('.card').forEach(cardEl => {
                            const cardItemId = cardEl.dataset.itemId;
                            if (hideCompleted && completedItems[cardItemId]) {
                                cardEl.style.display = 'none';
                            } else {
                                cardEl.style.display = 'flex';
                                hasVisibleCards = true;
                            }
                        });
                        if (hideCompleted && !hasVisibleCards && isBlockAllCompleted) {
                           headerEl.style.display = 'none';
                           cardGroupContainer.style.display = 'none';
                        }

                    } else {
                        cardGroupContainer.style.display = 'none';
                    }
                }
            });
        }

        function toggleBlock(headerElement, blockId, fase) {
            const cardGroup = document.querySelector(`.card-group-container[data-content-for="${blockId}"]`);
            const isExpanding = !headerElement.classList.contains('expanded');
            
            headerElement.classList.toggle('expanded', isExpanding);
            if (cardGroup) {
                cardGroup.classList.toggle('collapsed', !isExpanding);
            }
            
            expandedBlocks[blockId] = isExpanding;
            saveExpandedState();
            
            updateBlockHeaderStatus(headerElement, blockId, fase);
            applyFilters();
        }

        function renderTrainingGuide() {
            appContainer.innerHTML = '';
            notesSectionContainer.innerHTML = '';
            const trainingSequence = puppyTrainingData.sequenza_addestramento_cuccioli;
            
            if (pageDescriptionArea && trainingSequence.descrizione) {
                pageDescriptionArea.textContent = trainingSequence.descrizione;
            }

            trainingSequence.fasi.forEach(fase => {
                const phaseDiv = document.createElement('div');
                phaseDiv.className = 'phase-container';

                const itemsListContainer = document.createElement('div');
                itemsListContainer.className = 'items-list-container';
                
                const blockId = generateBlockId(fase.fase_id);
                
                const blockHeader = document.createElement('div');
                blockHeader.className = 'item-block-header';
                blockHeader.dataset.blockId = blockId;

                const iconSpan = document.createElement('span');
                blockHeader.appendChild(iconSpan);

                const headerInfo = document.createElement('div');
                headerInfo.className = 'header-info';
                headerInfo.innerHTML = `<span class="phase-title">${fase.descrizione}</span>`;
                blockHeader.appendChild(headerInfo);
                itemsListContainer.appendChild(blockHeader);

                const cardGroupContainer = document.createElement('div');
                cardGroupContainer.className = 'card-group-container collapsed';
                cardGroupContainer.dataset.contentFor = blockId;

                fase.esercizi.forEach(ex => {
                    const itemId = generateItemId(fase.fase_id, ex.ordine);
                    const card = createCardElement(ex, fase, itemId);
                    cardGroupContainer.appendChild(card);
                });
                itemsListContainer.appendChild(cardGroupContainer);
                
                const isInitiallyExpanded = !!expandedBlocks[blockId];
                blockHeader.classList.toggle('expanded', isInitiallyExpanded);
                cardGroupContainer.classList.toggle('collapsed', !isInitiallyExpanded);
                
                updateBlockHeaderStatus(blockHeader, blockId, fase);
                
                blockHeader.addEventListener('click', () => toggleBlock(blockHeader, blockId, fase));
                
                phaseDiv.appendChild(itemsListContainer);
                appContainer.appendChild(phaseDiv);
            });

            if (trainingSequence.note_importanti && trainingSequence.note_importanti.length > 0) {
                const notesContainer = document.createElement('div');
                notesContainer.className = 'notes-container';
                const notesTitle = document.createElement('h3');
                notesTitle.textContent = 'Note Importanti üí°';
                notesContainer.appendChild(notesTitle);
                const ul = document.createElement('ul');
                trainingSequence.note_importanti.forEach(nota => {
                    const li = document.createElement('li');
                    li.textContent = nota;
                    ul.appendChild(li);
                });
                notesContainer.appendChild(ul);
                notesSectionContainer.appendChild(notesContainer);
            }

            applyFilters();
        }

        function createCardElement(esercizioData, faseData, uniqueCardId) {
            const card = document.createElement('div');
            card.className = 'card';
            
            if (completedItems[uniqueCardId]) {
                card.classList.add('completed');
            }
            card.dataset.itemId = uniqueCardId;

            const videoId = getYoutubeVideoId(esercizioData.link);
            const thumbnailUrl = getYoutubeThumbnailUrl(videoId);

            card.innerHTML = `
                <div>
                    <a href="${esercizioData.link}" target="_blank" class="card-video-link">
                        <div class="card-thumbnail-container">
                            <img src="${thumbnailUrl}" alt="Miniatura video per ${esercizioData.titolo}" class="card-thumbnail">
                            <div class="card-thumbnail-overlay">
                                <span class="play-icon">‚ñ∂Ô∏è</span>
                            </div>
                        </div>
                        <p class="card-title">${esercizioData.ordine}. ${esercizioData.titolo}</p>
                    </a>
                    <p class="card-reason">${esercizioData.motivo}</p>
                </div>
                <div class="card-footer">
                    <input type="checkbox" id="cb_${uniqueCardId}" class="completed-checkbox" ${completedItems[uniqueCardId] ? 'checked' : ''}>
                    <label for="cb_${uniqueCardId}" class="completed-label">Fatto ‚úîÔ∏è</label>
                </div>
            `;
            card.querySelector('.completed-checkbox').addEventListener('change', (e) => {
                completedItems[uniqueCardId] = e.target.checked;
                saveCompletedStatus();
                card.classList.toggle('completed', e.target.checked);
                
                const blockId = generateBlockId(faseData.fase_id);
                const headerEl = document.querySelector(`.item-block-header[data-block-id="${blockId}"]`);
                updateBlockHeaderStatus(headerEl, blockId, faseData);
                applyFilters();
            });
            return card;
        }

        function toggleAllVisible(markAsCompleted) {
            document.querySelectorAll('.card-group-container:not(.collapsed) .card').forEach(card => {
                if (card.style.display !== 'none') {
                    const checkbox = card.querySelector('.completed-checkbox');
                    const itemId = card.dataset.itemId;
                    if (checkbox && checkbox.checked !== markAsCompleted) {
                        checkbox.checked = markAsCompleted;
                        completedItems[itemId] = markAsCompleted;
                        card.classList.toggle('completed', markAsCompleted);
                        
                        const faseId = itemId.match(/fase_([^_]+)_ex/)?.[1];
                        if (faseId) {
                            const fase = puppyTrainingData.sequenza_addestramento_cuccioli.fasi.find(f => f.fase_id === faseId);
                            if (fase) {
                                const blockId = generateBlockId(fase.fase_id);
                                const headerEl = document.querySelector(`.item-block-header[data-block-id="${blockId}"]`);
                                updateBlockHeaderStatus(headerEl, blockId, fase);
                            }
                        }
                    }
                }
            });
            saveCompletedStatus();
            applyFilters();
        }
        
        filterHideCompletedEl.addEventListener('change', () => {
            saveFiltersState();
            applyFilters();
        });
        
        uncheckAllVisibleButton.addEventListener('click', () => toggleAllVisible(false));
        checkAllVisibleButton.addEventListener('click', () => toggleAllVisible(true));
        themeToggleButton.addEventListener('click', toggleTheme);

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            applyCurrentTheme();
            renderTrainingGuide();
        });

    </script>
</body>
</html>